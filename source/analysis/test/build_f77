#!/bin/sh -f

# to build FORTRAN and CERNLIB related programs.

#set -x

build_debug=no
build_verbose=no
build_icc=no
build_clang=no
build_cl_exe=no
build_mem=no

use_from=sys

tools_mgr=../../../tools/mgr
tools_mgr=.

args=""
while test $# -ge 1 ; do
  case $1 in
    -g) build_debug=yes
        args="${args} $1"
        ;;
    -v) build_verbose=yes
        args="${args} $1"
        ;;
    -*) echo "unknwon option : $1" ; exit ;;
     *) echo "unknwon option : $1"
        ;;
  esac
  shift
done

#////////////////////////////////////
#/// C/C++ //////////////////////////
#////////////////////////////////////
. ${tools_mgr}/use_sys
. ${tools_mgr}/use_cc
. ${tools_mgr}/use_cpp
. ${tools_mgr}/use_f77

if [ `uname` = Darwin ] ; then
  if [ "`sysctl hw.optional.x86_64 | grep 1`" != "" ] ; then
    # gfortran is 32 bits !
    cppflags="${cppflags} -m32"
  fi
fi

#////////////////////////////////////
#////////////////////////////////////
#////////////////////////////////////

if [ ${build_verbose} = "yes" ] ; then
  set -x
fi

objs=""
libs=""

f77_objs=""
f77_libs=""

use_sys_cernlib=yes
. ${tools_mgr}/use_cernlib

# ////////////////////////////////////
# /// hello_f77.f ////////////////////
# ////////////////////////////////////

echo "build hello_f77.f ..."

${f77_compiler} ${f77flags} -c -o hello_f77.o hello_f77.f
${f77_compiler} ${f77flags} -o ./tools_test_hello_f77 hello_f77.o

# ////////////////////////////////////
# /// hbook.f ////////////////////////
# ////////////////////////////////////
echo "build hbook.f ..."

${f77_compiler} ${f77flags} -c -o hbook.o hbook.f
${f77_compiler} ${f77flags} -o ./tools_test_hbook hbook.o ${f77_objs} ${f77_libs}

# ////////////////////////////////////
# /// minuit.f ///////////////////////
# ////////////////////////////////////
echo "build minuit.f ..."

${f77_compiler} ${f77flags} -c -o minuit.o minuit.f
${f77_compiler} ${f77flags} -o ./tools_test_minuit minuit.o ${f77_objs} ${f77_libs}

# ////////////////////////////////////
# /// hbooknt.f //////////////////////
# ////////////////////////////////////

echo "build hbooknt.f ..."

${f77_compiler} ${f77flags} -c -o hbooknt.o hbooknt.f
${f77_compiler} ${f77flags} -o ./tools_test_hbooknt hbooknt.o ${f77_objs} ${f77_libs}

# ////////////////////////////////////
# /// chbook.cpp /////////////////////
# ////////////////////////////////////
echo "build chbook.cpp ..."

#hbook_dir=../../tools/hbook
hbook_dir=../include/tools/hbook

${f77_compiler} ${f77flags} -c -o close.o ${hbook_dir}/close.f
${f77_compiler} ${f77flags} -c -o setpawc.o ${hbook_dir}/setpawc.f

cppflags="${cppflags} ${G4_cppflags}"
cppflags="${cppflags} -I../.."
cppflags="${cppflags} -I../../../tools"
cppflags="${cppflags} -I../include"

${cpp_compiler} -c ${cppflags} -o chbook.o chbook.cpp
${cpp_compiler} ${cppflags} -o ./tools_test_chbook chbook.o close.o setpawc.o ${objs} ${libs}

# ////////////////////////////////////
# /// whbook.cpp /////////////////////
# ////////////////////////////////////
echo "build whbook.cpp ..."

${f77_compiler} ${f77flags} -c -o setntuc.o ${hbook_dir}/setntuc.f

${cpp_compiler} -c ${cppflags} -o whbook.o whbook.cpp
${cpp_compiler} ${cppflags} -o ./tools_test_whbook whbook.o setntuc.o setpawc.o close.o ${objs} ${libs}

# ////////////////////////////////////
# ////////////////////////////////////
# ////////////////////////////////////

find . -name "*.o" -exec /bin/rm -f {} \;
