# This is the GNUmakefile for building the C++ INCL4+ABLA testing
# reference library.


# Define your Fortran compiler. g77 is tested and known to work. New
# gfortran compiler distributed with GCC-4.0 does NOT work. Version
# 4.1 is not tested.
FC = g77

# Define your C++ compiler. g++ version 3.4.6 (RedHat 3.4.6-3)
# distributed with Scientific Linux CERN 4 is tested and known to
# work. G++ version 4.x is not tested.
CXX = g++

# The test driver can be compiled with ROOT data analysis system. This
# allows the test driver to write the output to ROOT files
# directly. If you don't have ROOT installed comment out the next
# three lines:
CXXFLAGS += -DUSEROOT
CXXFLAGS += $(shell root-config --cflags)
ROOTLIBS  += $(shell root-config --libs)

# CERNLIB is needed. This variable defines its installation directory
# (the directory containing subdirectories bin/ include/ lib/ src/ If
# you are using Scientific Linux CERN (e.g. SLC4) the library is
# probably installed in /cern/pro
CERNLIBDIR = /cern/pro

# Experimental: -ffloat-store
#FFLAGS = -ffloat-store

# Object files generated by $(FC) -c src/*.f

# To enable debugging symbols uncomment thetwo following lines.
#FFLAGS += -g
#CXXFLAGS += -g

# For INCL and ABLA
INCLABLAOBJS = src/FISSION_DISTRI.o src/abla_v3p.o	\
src/incl4.2.o src/init_incl42.o 

WRAPPEROBJS = src/InclAbla.o 

DICTOBJS = dict/InclAblaF_dict.o

# Object files generated by $(CXX) -c src/*.cc

# CERNLIB libraries needed for this simulation. We use versions
# without any calls to libshift library. If you want libshift just
# replace "noshift" with "shift" below.
CERNLIBS = $(shell $(CERNLIBDIR)/bin/cernlib_noshift)

# Include path for C++ compiler
CXXFLAGS += -I./include

FORTRANCPPLIBS=-lg2c

# Make targets:

# cugnon : The original example provided with incl4 and abla code

# rootlib : INCL4+ABLA module for ROOT. Requires ROOT to compile and
# run. This produces libLiegeCascade.so which can be loaded into the
# ROOT framework.

all : rootlib

#rootlib : proceduralcpp


rootlib : $(INCLABLAOBJS) $(WRAPPEROBJS) $(ROOTOBJS) dictionary 
	$(CXX) $(CXXFLAGS) -o libINCLABLA.so -shared $(INCLABLAOBJS) \
	$(WRAPPEROBJS) $(DICTOBJS) $(CERNLIBS) $(FORTRANCPPLIBS) $(ROOTLIBS)

staticlib : $(INCLABLAOBJS) $(WRAPPEROBJS) dictionary 
	ar r libINCLABLA.a $(INCLABLAOBJS) $(WRAPPEROBJS) $(DICTOBJS)


dictionary:
	mkdir -p dict
	rootcint -f dict/InclAblaF_dict.cc -c $(root-config --incdir) include/InclAblaF.hh \
	include/commonwrapper.hh include/functionwrapper.hh include/InclAblaLinkDef.h
	$(CXX) -c -o dict/InclAblaF_dict.o dict/InclAblaF_dict.cc $(CXXFLAGS) -I.

.PHONY: clean
clean:
	rm -f libINCLABLA.so
	rm -f dict/*.*
	rm -f *.o
	rm -f src/*.o


