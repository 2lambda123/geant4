
     =========================================================
 		  Geant4 - Hadrontherapy example
     =========================================================

                                README file
                          ----------------------

                                   AUTHORS 

G.A.P. CIRRONE(a *), G.CUTTONE(a), F. DI ROSA(a), G.RUSSO(a)
a. Laboratori Nazionali del Sud - Istituto Nazionale di Fisica Nucleare
   95123 Catania, Italy
* e-mail:cirrone@lns.infn.it

S. GUATELLI(b), M.G. PIA(b)
b. Istituto Nazionale di Fisica Nucleare, Sezione di Genova Via Dodecaneso, 33
   16146, Genova, Italy

More informations on the Hadrontherapy example can be found in the 
Hadrontherapy Documentation available at http://www.ge.infn.it/geant4/examples/

Alternatevely send an e-mail to cirrone@lns.infn.it.


---->0. INTRODUCTION.                                                    
                                                                       
The hadrontherapy example simulates a hadron therapy beam line. 
In particular the example models the specific proton therapy beam line
installed at Laboratori Nazionali del Sud (INFN) in Catania, Sicily (Italy).
For more information on the proton therapy center of Catania
or/and proton/hadron therapy in general, please visit the
pages:
http://www.lns.infn.it/catanaweb/catana/ 

---->1. GEOMETRY SET-UP.
 
The elements simulated are:

1. A scattering system, to spread geometrically the beam;

2. A system of collimators, to avoid the scattering radiation;

3. A modulation system that spreads the beam in energy and
   produces the so-called spread out bragg peak;
   It is constituted by a rotating wheel of different thichnesses.
   The wheel rotates around is axis (parallel to the proton
   beam axis) and its movement can be obtained by means of a 
   messenger between runs.

4. A set of monitor chambers (special transmission ionisation 
   chambers used to control hadron flux during the irradiation);

5. A "nozzle" and a final collimator defining the final shape
   of the beam before reaching the patient.

6. A water phantom: it is a box of water where the energy deposit is 
   calculated.
   The use of  the water phantom is required by the international protocol
   on the measure of dose in the case of proton and ion beams (IAEA 398, 2000).

---->2. EXPERIMENTAL SET-UP.      
                                      
The application simulates the proton therapy beam line
installed at Laboratori Nazionali del Sud.
The default beam line is a typical treatment line composed by several elements all
devoted to create the so-called "terapeutical beam", i.e. a beam ideal 
for a radiotherapeutic treatment.

   The main elements are:
** The COLLIMATORS: placed along the beam line to collimate the beam;

** The RANGE SHIFTERS: to decrease the energy of the primary proton beam 
   to a specific value;

** The MODULATOR WHEEL: to modulate the energy of the primary and monoenergetic
   beam in to a wide spectrum. The energy modulation is necessary to 
   homogeneusly irradiate a tumour volume that can extends in depth 
   up to 20 mm;

** The MONITOR CHAMBERS: very thin ionisation chamber that permit the 
   dose monitoring during the patient irradiation;

** The PATIENT COLLIMATOR: a brass, tumour-shaped collimator able to 
   confine the proton irradiation field in order to irradiate just the tumour mass
   in the trasverse direction;

The user has the possibility to vary, via messenger, almost all the geometrical 
characteristics of the beam line elements (i.e. their position along the beam line, 
their thickness, etc.). More details on the available user messengers can be 
found in the Hadronterapy Documentation (http://www.ge.infn.it/geant4/examples/).

At the end of the beam line, a typical water phantom is reproduced.
A user-defined region of the phantom is divided (via the ROGeomtry class) in 
cubic and identical voxels. The voxels size can be varied. At the end of the simulation 
the energy deposited by primary protons, and secondaries in each voxel
is collected. This information is available as an .hbk file (if the 
G4ANALYSIS_USE variable is defined).  

The default sizes of the active voxelized region are 40x40x40 mm corresponding
to a matric of 80x80x80 cubic voxels each with a lateral dimension of 0.5 mm. 

---->3. SET-UP 
                                                                        
- a standard Geant4 example GNUmakefile is provided                     

setup with:                                                             
compiler = gcc-3.2.3
G4SYSTEM = linux-g++                                                    

The following section reports the necessary environment variables 
necessary for the run of Hadrontherapy.                     

---->3.1  ENVIROMENT VARIABLES

 - G4SYSTEM = Linux-g++

 - G4INSTALL              points to the installation directory of GEANT4;

 - G4LIB                  point to the compiled libraries of GEANT4;

 - G4WORKDIR              points to the work directory;

 - CLHEP_BASE_DIR         points to the installation directory of CHLEP; 

 - G4LEVELGAMMADATA       points to the photoevaporation library;

 - NeutronHPCrossSections points to the neutron data files;

 - G4RADIOACTIVEDATA      points to the libraries for radio-active decay 
                          hadronic processes;
 
 - G4LEDATA               points to the low energy electromagnetic libraries

 - LD_LIBRARY_PATH = $CLHEP_BASE_DIR/lib

---->3.2  VISUALISATION

The user can visualise the experimental set-up with OpenGL, DAWN and vrml

---->4. HOW TO RUN THE EXAMPLE                                         

In interactive mode:
> $G4WORDIR/bin/Linux-g++/Hadrontherapy
The defaultMacro.mac is executed

The primary particle beam parameter are:
Radiation:                proton beam;
Energy distribution:      gaussian;
Mean energy:              63.4 MeV;
Energy spread:            300 keV;
Beam spot size:           1 mm;
Beam angular spread:      0.057 deg;

The modulator wheel can be rotated via the messenger:

Idle>/modulator/angle/xx deg

To produce a Spread Out Bragg Peak using the modulator a macro
(modulatorMacro.mac) is provided. With this macro the modulator is 
rotated of 360 degree at 1 deg steps. In each run 1000 protons are
generated as primary particles. Obviously a bigger resolution can be obtained 
with smaller angles or increasing the protons number in each run.

Modulator wheel can be omitted setting its material air.

run $G4WORKDIR/bin/Linux-g++/Hadrontherapy visualisationMacro.mac
to visualise the experimental set-up with OpenGL

---->5. PHYSICS

Both electromagnetic and hadronic physic processes are activated for the particles of the
experimental set-up.
Different physics models can be activated by the user interactively.
Examples of activation are provided in the macro files.
- protonEMLowEnergy.mac: example to activate e.m. low energy physics with different 
stopping power models for protons
- protonEMStandard.mac: example to activate the e.m. standard physics

---->6. SIMULATION OUTPUT                                    

The output is an .hbk file (hadrontherapy.hbk) produced 
if the variable G4ANALYSIS_USE is set to 1 and the analysis tool (AIDA
interface and PI) correctly installed.
The file contains an histogram and an n-tuple.
The histogram contains the Bragg curve: energy deposited 
by the proton beam (in MeV) versus the depth in water (in mm). 
The n-tuple contains the total 3D energy deposit in the phantom; the information
is energy deposit in each voxel with respect to the position of the voxel.

Setup for analysis: AIDA 3.2.1, PI 1.3.8.  

Users can download the analysis tools from:  
http://aida.freehep.org/
http://www.cern.ch/PI     

Note that the same information can be stored in any different format.
Please contact cirrone@lns.infn.it if you want store the information in 
a different format.

---------------------------------------------------------------------------

for comments, advices, doubts and questions please contact: 
cirrone@lns.infn.it, giorgiorusso@lns.infn.it

last modified: S. Guatelli, 30/05/2006

