{
// automated analysis for g4 cascade simulation
// root -b -q cascade.C

#include <iostream.h>

printf("::: Reading cascade data ...\n");

gROOT->Reset();

ifstream in;
// we assume a file basic.dat in the current directory
// this file has 3 columns of float data
in.open("cascade.out", ios::in);


Float_t   nEve, typePart, eKin, momX, momY, momZ;
Int_t nlines = 0;
TFile *f = new TFile("cascade.root","RECREATE");
TH1F *h1 = new TH1F("h1","particle types",100,-4,4);
TNtuple *ntuple = new TNtuple("ntuple","data from cascade.out","nEve:typePart:eKin:momX:momY:momZ");

while (1) {
  in >> nEve >> typePart >> eKin >> momX >> momY >> momZ;
  if (!in.good()) break;
  if (nlines < 5) printf("nEve=%8f, typePart=%8f, eKin=%8f\n",nEve, typePart, eKin);
  h1->Fill(typePart);
  ntuple->Fill(nEve, typePart, eKin, momX, momY, momZ);
  nlines++;
}
printf(" found %d points\n",nlines);

in.close();

f->Write();


//-----------
 
   c1 = new TCanvas("c1","The Ntuple canvas",200,10,700,780);

   gBenchmark->Start("ntuple1");
   //
   // Connect ROOT histogram/ntuple demonstration file
   // generated by example hsimple.C.
   f1 = new TFile("cascade.root");
   //
   // Inside this canvas, we create 4 pads
   //
   pad1 = new TPad("pad1","This is pad1",0.02,0.52,0.48,0.98,21);
   pad2 = new TPad("pad2","This is pad2",0.52,0.52,0.98,0.98,21);
   pad3 = new TPad("pad3","This is pad3",0.02,0.02,0.48,0.48,21);
   pad4 = new TPad("pad4","This is pad4",0.52,0.02,0.98,0.48,1);
   pad1->Draw();
   pad2->Draw();
   pad3->Draw();
   pad4->Draw();
   //
   // Change default style for the statistics box
   gStyle->SetStatW(0.30);
   gStyle->SetStatH(0.20);
   gStyle->SetStatColor(42);
   //
   // Display a function of one ntuple column imposing a condition
   // on another column.
   pad1->cd();
   pad1->SetGrid();
   pad1->SetLogy();
   pad1->GetFrame()->SetFillColor(15);
   ntuple->SetLineColor(1);
   ntuple->SetFillStyle(1001);
   ntuple->SetFillColor(45);
//   ntuple->Draw("momX","momY");
   ntuple->Draw("eKin", "typePart==1");
   ntuple->SetFillColor(38);
// ntuple->Draw("2*momZ","momY>10","same");
   ntuple->Draw("eKin","typePart==2","same");
   ntuple->SetFillColor(5);
   ntuple->Draw("eKin","(typePart==2 && momZ>200)","same");
   c1->Update();
   //
   // Display the profile of two columns
   // The profile histogram produced is saved in the current directory with
   // the name hprofs
   pad2->cd();
   pad2->SetGrid();
   pad2->GetFrame()->SetFillColor(32);
   ntuple->Draw("eKin:momX>>hprofs","","goffprofs");
   hprofs->SetMarkerColor(5);
   hprofs->SetMarkerSize(0.7);
   hprofs->SetMarkerStyle(21);
   hprofs->Fit("pol2");
   // Get pointer to fitted function and modify its attributes
   TF1 *fpol2 = hprofs->GetFunction("pol2");
   fpol2->SetLineWidth(4);
   fpol2->SetLineColor(2);
   c1->Update();
   //
   // Display a scatter plot of two columns with a selection.
   // Superimpose the result of another cut with a different marker color
   pad3->cd();
   pad3->GetFrame()->SetFillColor(38);
   pad3->GetFrame()->SetBorderSize(8);
   ntuple->SetMarkerColor(1);
   ntuple->Draw("momX:momZ","eKin>1");
   ntuple->SetMarkerColor(2);
   ntuple->Draw("momX:momY","eKin<100","same");
   c1->Update();
   //
   // Display a 3-D scatter plot of 3 columns. Superimpose a different selection.
   pad4->cd();
   ntuple->Draw("momX:momY:momZ","(momX<10 && momZ>6)+(momZ<4 && momZ>3)");
   ntuple->SetMarkerColor(4);
   ntuple->Draw("momX:momY:momZ","momX<6 && momZ>4","same");
   ntuple->SetMarkerColor(5);
   ntuple->Draw("momX:momY:momZ","momZ<4 && momZ>3","same");
   l4 = new TPaveText(-0.9,0.5,0.9,0.95);
   l4->SetFillColor(42);
   l4->SetTextAlign(12);
   l4->AddText("You can interactively rotate this view in 2 ways:");
   l4->AddText("  - With the RotateCube in clicking in this pad");
   l4->AddText("  - Selecting View with x3d in the View menu");
   l4->Draw();
   //
   c1->cd();
   c1->Update();
   gStyle->SetStatColor(19);
   gBenchmark->Show("ntuple1");


//-----------



printf("::: Writing ps files ...\n");
 c1->Print("cascade.ps");

/*
TPostScript* ps = new TPostScript("cascade.ps",-111);
   ps->Off();
   ps->On();
   ps->NewPage();
   c1->Update();
   ps->Off();
   ps->Close();
*/
}


