$Id: History,v 1.98 2004-12-07 08:28:55 gcosmo Exp $
-------------------------------------------------------------------

     =========================================================
     Geant4 - an Object-Oriented Toolkit for Simulation in HEP
     =========================================================

                      Category History file
                      ---------------------
This file should be used by G4 developers and category coordinators
to briefly summarize all major modifications introduced in the code
and keep track of all category-tags.
It DOES NOT substitute the  CVS log-message one should put at every
committal in the CVS repository !

     ----------------------------------------------------------
     * Reverse chronological order (last date on top), please *
     ----------------------------------------------------------

Dec. 7th, 2004, G.Cosmo transport-V06-02-05
-----------------------
- Implemented migration to <cmath>.

Nov. 23th, 2004, J.Apostolakis transport-V06-02-04
------------------------------
- Added Threshold energy for not abandoning stuck particles quickly.

Oct. 19th, H.Kurashige transport-V06-02-03
----------------------
- Migrated processes to new G4VParticleChange interface.

Sep. 9th, M.Maire
-----------------
- Apply tracking cut only if Rmin or Emin > DBL_MIN in G4UserSpecialCuts.

Oct. 8th, M.Asai transport-V06-02-02
----------------
- A protection is added in G4Transportation.cc for an application with parameterized
  volume but without any EM process.

Aug. 27th, M.Asai transport-V06-02-01
-----------------
- A pointer to sensitive detector is added in G4ParticleChangeForTransport.
- G4Transportation takes care of this pointer.

Jul. 26th, M.Asai transport-V06-02-00
-----------------
- Introduce G4UserStepLimit to handle MaxAllowedStep in G4UserLimits.

Feb. 5th, M.Asai transport-V06-00-00
----------------
- Fixed a bug in G4UserSpecialCuts related to charged geantino

Nov. 26th, G.Cosmo transport-V05-02-07
------------------
- Replaced mis-typed class name G4SplittingAndRussianRouletePostStepDoIt
  with G4SamplingPostStepAction and updated classes accordingly.
- Adopt new G4Exception scheme.
- Header inclusions and code cleanup.

Nov. 14th, G.Cosmo transport-V05-02-06
------------------
- G4Transportation.cc:
  o Added inclusion of G4ChordFinder.hh, after latest changes to field.

Oct. 4th, G.Cosmo transport-V05-02-05
-----------------
- Modified GNUmakefile:
  o added dependency to new module "geometry/navigation".
- Coworks with "geometry-V05-02-00" and "digits_hits-V05-02-00".

Sep. 25th, H.Kurashige transport-V05-02-04
----------------------
- modify GNUmakefile to use processes/cuts category
- migrate to model variant of EM physics in G4UserSpecialCuts (V.Ivantchenko)

Aug. 27th, M.Dressel transport-V05-02-03
--------------------
- cleanup of header file inclusions

Aug. 19th, M.Dressel transport-V05-02-02
--------------------
- rename G4ImportancePostStepDoIt to 
  G4SplittingAndRussianRouletePostStepDoIt since it is also used in 
  weight window biasing

Aug. 19th, M.Dressel transport-V05-02-01
--------------------
- first implementation of weight window technique

Jul, 31st, P.Gumplinger  transport-V05-02-00
-----------------------
- G4Transportation.cc:
  o Use the finalVelocity to update TofF for optical photons.

Jul, 17th, J.Apostolakis
------------------------
- G4Transportation.cc:
  o Attempt to correct photon problem - by using the velocity from
    current medium for massless particles.

Jun, 25th, J.Apostolakis
------------------------
- G4Transportation[.hh.icc]:
  o Added verbosity level to control the printing of warnings (see below).

Jun, 21st, J.Apostolakis  transport-V05-01-06
------------------------
G4Transportation:
- Added warning when energy changes from propagation in magnetic field 
  (or other field that conserves energy) due to the inaccuracy of 
  numerical integration of the equations of motion.

Jun, 21st, J.Apostolakis  transport-V05-01-05
------------------------
- G4Transportation:
  o Use new method of PropagatorInField to simplify choice of
    global/local field.
  o Activated the new capability of a (user derived) field manager to
    configure itself with different accuracy parameters depending on
    track's energy, particle identity, or other property.
- Notes:
  o Requires tags "field-V05-01-04" and "geomvol-V05-01-03"
  o Includes updates of files to use <std> in place of "g4std",
    as made at the CVS HEAD.

Jun, 13th, M.Dressel       transport-V05-01-04
--------------------
- Added to put the delete fImportancePostStepDoIt in G4MassImportanceProcess
  and G4ParallelImportanceProcess.

Jun, 13th, M.Dressel       transport-V05-01-03
--------------------
- Fixed bug created by last bug fix in G4MassImportanceProcess
  and G4ParallelImportanceProcess.

Jun, 12th, M.Dressel       transport-V05-01-02
--------------------
- Fixed "'this' : used in base member initializer list" in 
  src\G4MassImportanceProcess.cc, src\G4ParallelImportanceProcess.cc

Jun, 4th, G.Cosmo          transport-V05-01-01
-----------------
- Fixes for inclusion of <strstream> in G4ParallelImportanceProcess.cc
  and G4ParallelTransport.cc in view  of the g4std wrappers migration.

May, 13th, J.Apostolakis   transport-V05-01-00
------------------------
- Fixes to G4Transportation.cc to accomodate incorrect and
  missing functionality for two use cases:
  o a local field when no global field exists  (it was not seen)
  o overriding an existing global field by a 'zero' field
    by creating a local field manager that has a null G4Field pointer 
    (a use case which did not exist.)
  Further work to verify these use cases work is required.  

Apr, 7th, V.Ivanchenko     transport-V05-00-04
-----------------
- Migration to "cuts by region" for G4UserSpecialCuts.

Apr, 3rd, G.Cosmo          transport-V05-00-03
-----------------
- Cleared pedantic warnings and some cosmetic cleanups...

Jan, 14th, M.Asai          transport-V05-00-02
-----------------
- Consolidated transport-V05-00-01 tag for G4Transportation.cc

Jan, 7th, M.Asai           transport-V05-00-01
----------------
- Fix in G4Transportation.cc for updating material-cut-couple.

Dec, 16th, G. Cosmo        transport-V05-00-00
-------------------
- Merged branch "geant4-04-01-ref-02-cuts-branch" to HEAD.
  Included development for 'cuts-by-region' in G4Transportation.cc.

Nov, 20th, J. Apostolakis  transport-V04-01-05
-------------------------
- Tagged.
   Tag requires:   geomvol-V04-01-06 and tracking-V04-01-10
      and is dependent also on greps-V04-01-01 and track-V04-01-01. 

Nov, 8th, J.Generowicz
- Copy auxiliary smooth trajectory point from PIF to ParticleChange

Nov,  4th 2002 M.Dressel transport-V04-01-04
-----------------------------------------------------
- remove G4std:: where it does not belong to
- replace str() functions

Oct  31st, 2002 M.Dressel transport-V04-01-03
-----------------------------------------------------
- bug fix in G4MassGeometrySampler and G4ParallelGeometrySampler

Oct  28th, 2002 M.Dressel transport-V04-01-02
-----------------------------------------------------
- bug fix in G4MassGeometry

Oct  22th, 2002 M.Dressel internal_7_transport-V04-01-01
--------------------------------------------------------
- moving G4CellStoreScorer, G4TrackLogger
  to digits+hits/detector
- resolving G4SLRawValues

Oct  16th, 2002 M.Dressel internal_6_transport-V04-01-01
--------------------------------------------------------
- changes recomanded by codewizrd
- added GCellFinder concept

Oct  10th, 2002 M.Dressel transport-V04-01-01-internal-5
--------------------------------------------------------
- changing sampler concept: instead of separat samplers for
  all combinations of importance sampling, scoring, wieght roulette
  for parallel and mass geometry there are two Samplers now
  for the mass and parallel geometry: G4MassGeometrySampler 
  and G4ParallelGeometrySampler. 
- Introduction of Configurators to setup the processes.

Sep  18th, 2002 M.Dressel transport-V04-01-01-internal-4
--------------------------------------------------------
- tagging a version before reducing the number of Samplers

Sep  2th, 2002 M.dressel  transport-V04-01-01-internal-3
-----------------------------------------
    code cleanup for code-wizard

Aug  29th, 2002 M.Dressel int-1-V04-01-01
-----------------------------------------
- adopted to changes in int-2-geombias-V04-01-01:
     renaming of G4PTouchableKey to G4GeometryCell 
     changing  G4VIStore and G4IStore 
     and dependants

Aug  13th, 2002 M.Dressel transport-V04-01-01
----------------------------------------------
- added G4CellStoreScorer,  G4VTrackTerminator and changed the sampler
  classes in order to use the G4VTrackTerminator (if necessary) to
  kill a track. 
- coworks with geombias-V04-01-01

July 18th, 2002 M.Dressel 
-------------------------
- bug fix in G4TrackLogger

July 11th, 2002 M.Dressel internal-2-transport-V04-01-01
--------------------------------------------------------
- moved the standard scoring classes to run because 
  they need G4EventManager.

July 10th, 2002 M.Dressel internal-1-transport-V04-01-01
--------------------------------------------------------
- add classes for standard scoreing. Remove G4ScorePrinter and G4Scorer.
  G4StandardScorer and G4StandardScoreTable may be used as replacement.
  The source file G4StandardScorer.cc may be found in 
  extended/examples/B09/src because it needs to acces the
  G4EventManager.

Jun   13, 2002 M.Dressel transport-V04-00-09 
---------------------------------------------
- add classes for creating and printing tallies.

May   31, 2002  M.Dressel transport-V04-00-08
--------------------------------------------------------
- made weight window sampling to apply only at inital track step 1.

May   31, 2002  M.Dressel transport-V04-00-07
--------------------------------------------------------
- bug fix in G4PArallelScoreSampler.cc and remove Warning from ParallelTransport

May   31, 2002  M.Dressel transport-V04-00-06
--------------------------------------------------------
- renaming of the Manager classes to Sampler classes 
- substitution of G4ParallelManager inside the Sampler classes

May   30, 2002  M.Dressel 
--------------------------------------------------------
- chamged G4VImportanceScoreConstructor to G4VSampler

May   30, 2002  M.Dressel 
--------------------------------------------------------
- all the ImportanceScoreManagers derive form 
  G4VImportanceScoreConstructor 

May   30, 2002  M.Dressel internal-3-transport-V04-00-05
--------------------------------------------------------
- changes in Importance Manager constructors, G4ImportanceAlgorithm as 
  pointer

May   29, 2002  M.Dressel internal-2-transport-V04-00-05
--------------------------------------------------------
- bug fix in G4PImportanceWWindowScoreManager.cc
  and G4ParallelImportanceManager.hh.

May   24, 2002  M.Dressel internal-1-transport-V04-00-05
-------------------------
- Change in G4VProcessPlacer and G4ProcessPlacer: add member function
  RemoveProcess to properly remove a process.
- Add classes for wieght window biasing.


May   02, 2002  M.Dressel 
-------------------------
- Change in G4ProcessPlacer: set process vector via process manager not 
  directly. 
- Change in G4ParallelTranport: use StartTracking to signal inital step.
  This should help to locate "suspended" tracks.

April 24, 2002  G.Cosmo - transport-V04-00-05
-----------------------
- Added G4DEBUG_TRANSPORT flag in GNUmakefile and (on suggestionh of
  J.Apostolakis) replaced to G4VERBOSE in G4Transportation::PostStepDoIt()
  for extra-check on volume boundary.
  Issues addressed by problem report #130 should now be resolved.

April 10, 2002  M.Dressel - transport-V04-00-04
-------------------------
- Added comments to headers of transportation classes and managers for
  importance biasing, to fullfill Software Reference Manual.

Apr 9, 2002 G.Cosmo
-------------------
- Added liability disclaimer to scorer classes and minor cosmetics.

Apr 8, 2002 M.Dressel - transport-V04-00-03
---------------------
- Resolved compilation problems on HP-aCC.

Apr 4, 2002 M.Dressel - transport-V04-00-02
---------------------
- Cleaned compilation problems for G4std/std.

Apr 4, 2002 M.Dressel - transport-V04-00-01
---------------------
- Resolved compilation problems on SUN-CC and Linux-egcs.

Mar  28, 2002 M.Dressel - transport-V04-00-00
-----------------------
- First implementation of transportation classes and managers for importance
  biasing and scoring. Co-works with "geometry-V04-00-01".

Mar  25, 2002 G.Cosmo
---------------------
- Added dependency to new module geometry/biasing in GNUmakefile.

Dec   8, 2001 J.Apostolakis - transport-V03-02-07
---------------------------
- Activated the killing of 'looping' particles -- to be used also to
  abandon (kill) particles that are stuck (eg at boundaries).
  [ Fix for problems of stuck particles reported by CMS (P.Arce),
    and Atlas (A.Del'Acqua, A.Rimoldi) ] 

Nov  28, 2001 J.Apostolakis - transport-V03-02-06
---------------------------
- Fix for the new updating of the time for fields -- correcting previous 
  tag.  By keeping account whether the field changes the energy (and 
  therefore the velocity) in the field manager.

  Requires and co-works with
   - "field-V03-02-07" 
   - "geomvol-V03-02-02"
  in order to compile (let alone have any effect.)

Nov  10, 2001 J.Apostolakis - transport-V03-02-05
---------------------------
- Motivated by the use case of an Electric Field,
   * in order to achieve reasonable accuracy in time integration,
   * and to enable fields that vary with the global time
  changed Transportation to try to obtain the delta_time from FieldTrack.
  Co-works with and requires "field-V03-02-03" to have any effect.

Nov   9, 2001   G. Cosmo - transport-V03-02-04
------------------------
- Fix in G4Transportation.cc for initialisation of touchable handle.

Nov   8, 2001   G. Cosmo - transport-V03-02-03
------------------------
- Introduced changes to G4Transportation for reference-counted
  touchables (R.Chytracek). Added methods GetFreeTouchable() and
  SetTheOtherTouchableFree(G4VTouchable*).

Nov   6, 2001   J. Apostolakis - transport-V03-02-02
------------------------------
- Added protection in G4Transportation::AlongStepGPIL for messaging
  "ResestStepEstimate" of ChordFinder for the case there is no global field.
  ** NOTE this is not a perfect resolution (see NOTE in log file). **
  --> Thanks to Radovan Chytracek for reporting this problem (move to file log)

Aug  16, 2001   J. Apostolakis - transport-V03-02-01
------------------------------
- Tagged. (This tag requires field-V03-02-00)

Aug  16, 2001   J. Apostolakis
------------------------------
- Erasing state information from previous track at the first step of
  each track.  (-> this is required to ensure repeatability)
  This should eliminate any non-repeatability due to the propagation
  in field.
  ( Requires updated version of G4ChordFinder )

Jul  19, 2001   G. Cosmo  transport-V03-02-00
------------------------
- Synchronised with CVS HEAD after introduction of warrenty disclaimer.
- Modified author list in G4Transportation (P.Gumplinger).

Apr  11, 2001   J. Apostolakis   transport-V03-01-02
------------------------------
- Corrected the last update of G4Transportation.cc, which overwrote the 
  value of the spin in the cases where a particle was not charged (eg photon)
  or a charged particle was not in a field. 

Apr  11, 2001   P. Gumplinger   transport-V03-01-01
-----------------------------
- Updated G4Transportation.cc to make spin tracking work correctly:
  o Replaced the line originally commented out:
      // fTransportEndPolarization= aFieldTrack.GetSpin() ; // Not yet possible
    with: 
      fTransportEndSpin = aFieldTrack.GetSpin();
  o Added to the AlongStepDoIt() the following call:
      fParticleChange.SetPolarizationChange(fTransportEndSpin);

Mar  19, 2001   J. Apostolakis  transport-V03-00-01
------------------------------
- G4Transportation modified to use new FieldTrack, and get Kinetic
  Energy from it. 
  This new FieldTrack together with changes in associated Equation of Motion
  classes implement the momentum vector as independent variable in place of
  the velocity. 
  So this tag requires 
  - new geometry/magneticfield tag "field-V03-00-01",  and 
  - new geometry/volumes  tag "geomvol-V03-00-03" for new
    G4PropagatorInField ().

Feb  27, 2001   J. Apostolakis  (transport-V03-00-00)
------------------------------
- G4Transportation.cc:
  *   Modified calculation of energy at the end of field step
       to make it more accurate at low velocities,
       (while remaining correct at high gammas). 
  This improves the energy determination. 
  Together with electromagnetic/standard tag  "stand-V03-00-03"
  this addresses the main problem in propagating in an electric field
  (Problem report # 108 )

Sep  22, 2000   V. Grichine	(transport-V02-00-00)  [recorded by G.Cosmo]
---------------------------
- G4Transportation.cc:
  o added formula for Tkin corresponding directly to
    relativistic definition of Tkin = Etot - mc^2 = mc^2(gamma -1),
    where gamma is a particle Lorentz factor.
  o general cosmetics.

Jun  19, 2000   J. Apostolakis  (transport-V01-01-02)
------------------------------
- G4Transportation.cc: Set the True Step Length in G4Transportation.cc
- Cosmetic:  updated other files to the head, as there were no differences
  from it (CVS headers).

May  15, 2000   J. Apostolakis	(transport-V01-01-01)
------------------------------
- G4Transportation.cc:  Set the material in materialChange, in order to get
  correct behaviour for volumes that parameterise the material.
  (Fix is dependant on changes to particleChangeForTransport and StepPoint)
- Modified setting of touchable change, in order to preserve const-ness where
  it exists.

Nov  25, 1999   J. Apostolakis  (transport-V00-01-01)
------------------------------
- G4Transportation.cc: Added protection for the case of a zero step (when
  there is a field)
- G4UserSpecialCuts: protection to use min range and min kinE only for
  charged particles.

June  9, 1999   J. Apostolakis  (transport-01-00-02)
------------------------------
- Added a protection so that full relocation is not used for very small moves.

Dec   4, 1998   J. Apostolakis  (transport-00-04-01)
------------------------------
- The Velocity Vector for Transport in a magnetic field is now set correctly.
  (previously the scalar velocity was automatically promoted to a 3-vector)

Nov  25, 1998  J. Apostolakis   
-----------------------------
- Added the direction to  LocateGlobalPointAndUpdateTouchable.

Nov  19, 1998   J. Apostolakis  (transport-00-03-04)
------------------------------
- Fixes:
  1) The final energy is set equal to the initial energy, because
     the PropagatorInField does not calculate it correctly yet.  NEEDS Fix
  2) If the requested step size is zero and safety is zero,  the
     step is now considered geometry limited.  (This can happen
     if a discrete process tries to take a  step that is very small
     compared to the mean free path.)  Problem observed by Laszlo in EM tests.
  3) PostStepGetInteractionLength now returns DBL_MAX, not kInfinity.

Nov  11, 1998   J. Apostolakis  (transport-00-03-03)
------------------------------
- Changes to accomodate new interface of Field: 
  G4PropagatorInField and G4FieldTrack.

Oct  30, 1998  J. Apostolakis   (transport-00-03-02)
-----------------------------
- In the case of magnetic field, a flag that determines whether the
  geometry limited the step was not set.

Sep  16, 1998  J. Apostolakis   (transport-00-03-01)
-----------------------------
- Checks whether the particle is out of the world volume,
  if so it has exited and must be killed.

Aug  28, 1998  J. Apostolakis 
-----------------------------
- The PostStepGetPhysicalInteractionLength has fixed (to return kInf)
  The boolean flags for touchables are now initialised. & Other small fixes ?
  Test code for non-relocating case added (for debugging).

June 08, 1998   J. Apostolakis  (trans-06-04)
------------------------------
- Corrected Safety computation for the case of the field (adding endpoint
  distance instead of curve length.) 
- Added PostStepDoIt method that tries to relocate the particle using
  G4ParticleChangeForTransport
- Transportation is no longer a G4ContinuousProcess. 

June 08, 1998   J. Apostolakis  (trans-06-03)
------------------------------
- Modified it to recomputate Safety at the start of a step.  To do this
  it uses the previous step's  calculated safety and endpoint.

June 08, 1998   J. Apostolakis  (trans-06-02)
------------------------------
- Modified it to add re-computation of Safety at the endpoint of a step,
  when the safety would become negative.  This is done to allow processes
  to benefit from a realistic (geometrical) value of the safety.  The
  request to do this was from EM physics

June 03, 1998   J. Apostolakis  (trans-06-01)
------------------------------
- The safety we is now generalised to mean the limit of assumption of all
  processes. The AlongStepGPIL input value is not the remainder from the
  previous step's geometrical safety.
  So the transportation must recalculate the starting point's safety here.
  As a zeroeth order approximation we set it to zero.

April 17, 1998  M. Maire      [recorded by John Apostolakis]
------------------------
- A new process, G4UserSpecialCuts, was added to allow the
  user an alternative method to set some user cuts.

April 15, 1998  H. Kurasige   [recorded by John Apostolakis]
---------------------------
- The transportation does the absolute minimum required to conform to 
  the new scheme for ParticleChange: G4VParticleChange is used in signature. 
  [ But default G4ParticleChange is still used ]. 

April 14, 1998  John Apostolakis
--------------------------------
- History file Created
