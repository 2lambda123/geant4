-------------------------------------------------------------------
$Id: README,v 1.8 2006-06-23 10:53:39 sincerti Exp $
-------------------------------------------------------------------

     =========================================================
 		  Geant4 - Microbeam example
     =========================================================

                                README file
                          ----------------------

                           CORRESPONDING AUTHOR 

S. Incerti (a, *) et al.
a. Centre d'Etudes Nucleaires de Bordeaux-Gradignan 
(CENBG), IN2P3 / CNRS / Bordeaux 1 University, 33175 Gradignan, France
* e-mail:incerti@cenbg.in2p3.fr

Last modified by S. Incerti, 23/06/2006

---->0. INTRODUCTION.                                                    
                                                                       
The microbeam example simulates the cellular irradiation beam line 
installed on the AIFIRA electrostatic accelerator facility located at 
CENBG, Bordeaux-Gradignan, France. For more information on this facility, 
please visit :
http://www.cenbg.in2p3.fr/


---->1. GEOMETRY SET-UP.
 
The elements simulated are:

1. A switching dipole magnet with fringing field, to deflect the 3 MeV alpha 
beam generated by the electrostatic accelerator into the microbeam line, 
oriented at 10 degrees from the main beam direction;

2. A circular collimator object, defining the incident beam size at the 
microbeam line entrance;

3. A quadrupole based magnetic symmetric focusing system allowing equal 
transverse demagnifications of 10. Fringe fields are calculated from Enge's 
model.

4. A dedicated cellular irradiation chamber setup;

5. A set of horizontal and vertical electrostatic deflecting plates which can 
be turned on or off to deflect the beam on target; 

6. A realistic human keratinocyte voxellized cell observed from confocal 
microscopy and taking into account realistic nucleus and cytoplasm chemical 
compositions


---->2. EXPERIMENTAL SET-UP.      
                                 
The beam is defined at the microbeam line entrance through a collimator 
5 micrometer in diameter. The beam is then focused onto target using a 
quadruplet of quadrupoles in the so-called Dymnikov magnetic configuration. 
The beam is sent to the irradiation chamber where it travels through a 
isobutane gas detector for counting purpose before reaching the polypropylene 
culture foil of the target cell which is immersed in the growing medium and 
enclosed within a dish.  

A cell is placed on the polypropylene foil and is irradiated using the 
microbeam. The cell is represented through a 3D phantom (G4PVParameterization) 
obtained from confocal microscopy. In the provided example, the voxels sizes 
are : 359 nm (X) x 359 nm (Y) x 163 nm (Z)

The primary particle beam parameters are generated from experimental 
measurements performed on the AIFIRA facility. Incident particle used for 
cellular irradiation are 3 MeV alpha particles.

More details on the experimental setup and its simulation with Geant4 can 
be found in the following papers :

- GEANT4 SIMULATION OF THE NEW CENBG MICRO AND NANO PROBES FACILITY
By S. Incerti, C. Habchi, Ph. Moretto, J. Olivier and H. Seznec
To be published in NIMB, 2006

- DEVELOPMENT OF A FOCUSED CHARGED PARTICLE MICROBEAM FOR THE IRRADIATION OF 
INDIVIDUAL CELLS.
By Ph. Barberet, A. Balana, S. Incerti, C. Michelet-Habchi, Ph. Moretto, 
Th. Pouthier (CENBG, Gradignan),. Dec 2004. 6pp. 
Published in Rev.Sci.Instrum.76:015101, 2005

- SIMULATION OF CELLULAR IRRADIATION WITH THE CENBG MICROBEAM LINE USING 
GEANT4.
By S. Incerti, Ph. Barberet, R. Villeneuve, P. Aguer, E. Gontier, 
C. Michelet-Habchi, Ph. Moretto, D.T. Nguyen, T. Pouthier, R.W. Smith 
(CENBG, Gradignan),. Oct 2003. 6pp. 
Published in IEEE Trans.Nucl.Sci.51:1395-1401, 2004


---->3. SET-UP 
                                                                        
- a standard Geant4 example GNUmakefile is provided                     

setup with:                                                             
compiler = gcc-3.2.3
G4SYSTEM = linux-g++                                                    

The following section gives the necessary environment variables.                     

------->>3.1  ENVIRONMENT VARIABLES

All variables are defined with their default value.

 - G4SYSTEM = Linux-g++

 - G4INSTALL              points to the installation directory of GEANT4;

 - G4LIB                  point to the compiled libraries of GEANT4;

 - G4WORKDIR              points to the work directory;

 - CLHEP_BASE_DIR         points to the installation directory of CHLEP; 

 - G4LEDATA               points to the low energy electromagnetic libraries;

 - LD_LIBRARY_PATH = $CLHEP_BASE_DIR/lib

 - G4LEVELGAMMADATA       points to the photoevaporation library;

 - NeutronHPCrossSections points to the neutron data files;

 - G4RADIOACTIVEDATA      points to the libraries for radio-active decay 
                          hadronic processes;
 
However, the $G4LEVELGAMMADATA, $NeutronHPCrossSections and $G4RADIOACTIVEDATA
variables do not need to be defined for this example.

Once these variables have been set, simply type gmake to compile the Microbeam
example. 

------->>3.2  VISUALIZATION

The user can visualize the targeted cell with OpenGL, DAWN and vrml, 
as chosen in the microbeam.mac file. OpenGL is the default viewer. The 
cytoplasm in shown in red and the nucleus in green.


---->4. HOW TO RUN THE EXAMPLE                                         

In interactive mode, run:

> $G4WORDIR/bin/Linux-g++/Microbeam

The macro microbeam.mac is executed by default. To get vizualisation, make
sure to uncomment the /vis/... lines in the microbeam.mac macro.
The Microbeam code reads the phantom.dat file containing all the necessary 
information describing the cell phantom. 10 alphas particles are generated.


---->5. PHYSICS

Low energy electromagnetic processes (for alphas, electrons, photons) and 
hadronic elastic and inelastic scattering for alphas are activated by default. 
Low energy electromagnetic electronic and nuclear stopping power are computed 
from ICRU tables.
	

---->6. SIMULATION OUTPUT AND RESULT ANALYZIS                                    

This example does not need any external analysis package. 
The output results consists in several .txt files:

* dose.txt : gives the total deposited dose in the cell nucleus and in the cell 
cytoplasm by each incident alpha particle;

* 3DDose.txt : gives the average on the whole run of the dose deposited per 
Voxel per incident alpha particle;

* range.txt : indicates the final stopping (x,y,z) position of the incident 
alpha particle within the irradiated medium (cell or culture medium)

* stoppingPower.txt : gives the actual stopping power dE/dx of the incident 
alpha particle just before penetrating into the targeted cell;

* beamPosition.txt : gives the beam transverse position distribution(X and Y) 
just before penetrating into the targeted cell;

These files can be easily analyzed using for example the provided ROOT macro 
file plot.C; to do so :
* be sure to have ROOT installed on your machine
* be sure to be in the microbeam directory
* launch ROOT by typing root
* under your ROOT session, type in : .X plot.C to execute the macro file

A graphical output obtained with this macro for 40000 incident alpha particles 
is shown in the file microbeam.gif

The simulation predicts that 95% of the incident alpha particles detected by the
gas detector are located within a circle of 10 um in diameter on the target, in 
nice agreement with experimental measurements performed on the CENBG setup.

---------------------------------------------------------------------------

Should you have any enquiry, please do not hesitate to contact: 
incerti@cenbg.in2p3.fr
