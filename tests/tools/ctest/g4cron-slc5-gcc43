#!/usr/bin/env bash

#------------------------------------------------------------------
export LC_CTYPE=en_US.UTF-8
export LC_ALL=en_US.UTF-8

#---Xerces-C-------------------------------------------------------
export XERCESC_ROOT_DIR=/afs/cern.ch/sw/lcg/external/XercesC/3.1.0/x86_64-slc5-gcc43-opt
export LD_LIBRARY_PATH=${XERCESC_ROOT_DIR}/lib:${LD_LIBRARY_PATH}

#---Inventor--------------------------------------------------------
export PATH=/afs/cern.ch/sw/lcg/external/coin3d/3.1.3.p1/x86_64-slc5-gcc43-opt/bin:${PATH}
export LD_LIBRARY_PATH=/afs/cern.ch/sw/lcg/external/coin3d/3.1.3.p1/x86_64-slc5-gcc43-opt/lib:${LD_LIBRARY_PATH}

#---CLHEP----------------------------------------------------------
export CLHEP_ROOT_DIR=/afs/cern.ch/sw/lcg/external/clhep/2.1.2.3/x86_64-slc5-gcc43-opt
export LD_LIBRARY_PATH=${CLHEP_ROOT_DIR}/lib:${LD_LIBRARY_PATH}

#---Qt-------------------------------------------------------------
export QTDIR=/afs/cern.ch/sw/lcg/external/qt/4.6.3p2/x86_64-slc5-gcc43-opt

#---CMake----------------------------------------------------------
export PATH=${PATH}:/afs/cern.ch/sw/lcg/external/CMake/2.8.6/x86_64-slc5-gcc43-opt/bin

#---ROOT----------------------------------------------------------
. /afs/cern.ch/sw/lcg/app/releases/ROOT/5.32.02/x86_64-slc5-gcc43-opt/root/bin/thisroot.sh

#---GCCXML--------------------------------------------------------
export PATH=/afs/cern.ch/sw/lcg/external/gccxml/0.9.0_20110825/x86_64-slc5-gcc43-opt/bin:${PATH}

#---Compiler------------------------------------------------------
export PATH=/afs/cern.ch/sw/lcg/contrib/gcc/4.3/x86_64-slc5-gcc43-opt/bin:${PATH}
export LD_LIBRARY_PATH=/afs/cern.ch/sw/lcg/contrib/gcc/4.3/x86_64-slc5-gcc43-opt/lib64:${LD_LIBRARY_PATH}

#---Python--------------------------------------------------------
#Needed for PhysicsChecks: python compatible with ROOT
export PATH=/afs/cern.ch/sw/lcg/external/Python/2.6.5p2/x86_64-slc5-gcc43-opt/bin:${PATH}
export LD_LIBRARY_PATH=/afs/cern.ch/sw/lcg/external/Python/2.6.5p2/x86_64-slc5-gcc43-opt/lib:${LD_LIBRARY_PATH}

#-----------------------------------------------------------------
THIS=$(dirname $0)

if [ x$WORKDIR = x ]; then 
  WORKDIR=/build/cdash/G4 
fi
if [ x$VERSION = x ]; then 
  export VERSION=g4tags-dev
fi

export OPTIONS="\
-DGEANT4_USE_G3TOG4=ON;\
-DGEANT4_USE_OPENGL_X11=ON;\
-DGEANT4_USE_QT=ON;\
-DGEANT4_USE_RAYTRACER_X11=ON;\
-DGEANT4_USE_SYSTEM_CLHEP=ON;\
-DCLHEP_ROOT_DIR=${CLHEP_ROOT_DIR};\
-DGEANT4_USE_XM=ON"

#----Nightly------------------------------------------------------
CONFIG=slc5-gcc43
MODE=nightly
export SOURCE=${WORKDIR}/${MODE}/${VERSION}
export BINARY=${WORKDIR}/${MODE}/${CONFIG}
if [ ! -d "${SOURCE}" ]; then 
  ${THIS}/g4tagsvn.py update -c ${VERSION} -d ${SOURCE} -q
fi
export G4_XOPTS=${OPTIONS}
ctest -V -S ${THIS}/g4${MODE}.cmake 

#---Nightly-TestRelease--------------------------------------------
MODE=nightly
export BUILDTYPE=TestRelease
export SOURCE=${WORKDIR}/${MODE}/${VERSION}
export BINARY=${WORKDIR}/${MODE}/${CONFIG}-testrelease
if [ ! -d "${SOURCE}" ]; then 
  ${THIS}/g4tagsvn.py update -c ${VERSION} -d ${SOURCE} -q
fi
export G4_XOPTS=${OPTIONS}
ctest -V -S ${THIS}/g4${MODE}.cmake
unset BUILDTYPE

#---Nightly-StaticLibs--------------------------------------------
MODE=nightly
export BUILDTYPE=staticlibs
export SOURCE=${WORKDIR}/${MODE}/${VERSION}
export BINARY=${WORKDIR}/${MODE}/${CONFIG}-staticlibs
if [ ! -d "${SOURCE}" ]; then 
  ${THIS}/g4tagsvn.py update -c ${VERSION} -d ${SOURCE} -q
fi
export G4_XOPTS="-DBUILD_STATIC_LIBS=ON;-DBUILD_SHARED_LIBS=OFF"
ctest -V -S ${THIS}/g4${MODE}.cmake
unset BUILDTYPE

#---PhysicsChecks-------------------------------------------------
MODE=physicschecks
export SOURCE=${WORKDIR}/${MODE}/${VERSION}
export BINARY=${WORKDIR}/${MODE}/${CONFIG}
if [ ! -d "${SOURCE}" ]; then 
  ${THIS}/g4tagsvn.py update -c ${VERSION} -d ${SOURCE} -q
fi
export G4_XOPTS=${OPTIONS}
ctest -V -S ${THIS}/g4${MODE}.cmake 

#---Continuous----------------------------------------------------
MODE=continuous
export SOURCE=${WORKDIR}/${MODE}/${VERSION}
export BINARY=${WORKDIR}/${MODE}/${CONFIG}
if [ ! -d "${SOURCE}" ]; then 
  ${THIS}/g4tagsvn.py update -c ${VERSION} -d ${SOURCE} -q -p
fi
export G4_XOPTS=${OPTIONS}
ctest -V -S ${THIS}/g4${MODE}.cmake 


