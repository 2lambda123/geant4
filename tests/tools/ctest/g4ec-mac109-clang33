#!/usr/bin/env bash
#------------------------------------------------------------------

CONFIG=mac109-clang33

#---Xerces-C-------------------------------------------------------
export XERCESC_ROOT_DIR=/ec/externals/xerces-c-3.1.1/x86_64-mac109-clang33-opt
export DYLD_LIBRARY_PATH=${XERCESC_ROOT_DIR}/lib:${DYLD_LIBRARY_PATH}

#---Clang Compiler---------------------------------------------------
export CC=clang
export CXX=clang++

#-----------------------------------------------------------------
THIS=$(dirname $0)


if [ x$MODE = x ]; then
  export MODE=nightly
fi
if [ x$WORKDIR = x ]; then 
  WORKDIR=/ec/G4-builds
fi
if [ x$VERSION = x ]; then 
  export VERSION=g4tags-dev
fi

if [ x$BUILDTYPE = x ]; then
   PLATFORM=${WORKDIR}/${MODE}/${CONFIG}
else
   PLATFORM=${WORKDIR}/${MODE}/${CONFIG}-${BUILDTYPE}
fi

export SOURCE=${PLATFORM}/${VERSION}
export BINARY=${PLATFORM}/build
#
#default, to be modified for non default buildtypes
#

  export G4_XOPTS="-DGEANT4_USE_G3TOG4=ON;\
-DGEANT4_USE_RAYTRACER_X11=ON;"


case "${BUILDTYPE}" in 

   staticlibs)
	   export G4_XOPTS="-DBUILD_STATIC_LIBS=ON;-DBUILD_SHARED_LIBS=OFF"
	   ;;
   MT)
	   export G4_XOPTS="${G4_XOPTS};-DGEANT4_BUILD_MULTITHREADED=ON"
	   ;;
   MTmax)
	   export G4_XOPTS="${G4_XOPTS};-DGEANT4_BUILD_MULTITHREADED=ON"
	   export G4FORCENUMBEROFTHREADS="max"
	   ;;
esac

if [ "${RESET_SOURCE}" = "yes" ]; then
  rm -rf ${SOURCE}
fi

if [ ! -d "${SOURCE}" ]; then 
  ${THIS}/g4tagsvn.py update -c ${VERSION} -d ${SOURCE} -q
fi

ctest -V -S ${THIS}/g4${MODE}.cmake

