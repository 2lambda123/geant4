#!/usr/bin/env bash
#------------------------------------------------------------------
export LC_CTYPE=en_US.UTF-8
export LC_ALL=en_US.UTF-8

#-----------------------------------------------------------------
THIS=$(dirname $0)
if [ "$1" ]; then
  MODE=$1
else
  MODE=nightly
fi

if [ x$WORKDIR = x ]; then 
  WORKDIR=/cdash/G4 
fi
if [ x$VERSION = x ]; then 
  export VERSION=g4tags-dev
fi

CONFIG=slc5-gcc41
export BINARY=${WORKDIR}/${MODE}/${CONFIG}

#---Update All Scripts------------------------------------------------
svn update ${THIS}

if [ x$SOURCE = x ];then
  export SOURCE=${WORKDIR}/${MODE}/${VERSION}
  #---Checkout Geant4 sources ---------------------------------------
  rm -rf ${SOURCE}
  ${THIS}/g4tagsvn.py checkout -c ${VERSION} -d ${SOURCE} -q
fi

#---Run the CTest script-------------------------------------------
echo "Starting CTest script for configutation ${CONFIG} at `date`" 
ctest -V -S ${THIS}/g4${MODE}.cmake 

