<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
<title> Geant4 System Test Team Procedures </title>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.7 [en] (X11; I; Linux 2.2.12-20 i686) [Netscape]">
</head>
<body>

<h1> System Test Procedures</h1>
<P>
<b>Please note: Sytem Test Procedures are being updated.</b>
<br>John, Serguei and Steve, 5th April 2000.
<h1>
The System Testing Area at CERN</h1>
All source, binaries and output are kept under <b><tt>/afs/cern.ch/sw/geant4/stt/</tt></b>.&nbsp;
This area is read accessible to all Geant4 Collaborators (zb:collaborators
rl) and write-accessible to the STT group (zb:sttmembers rlidwka).
<p>Note that sometimes this area contains symbolic links to local discs
of specific machines to improve performance.&nbsp; E.g.:
<blockquote><b><tt>/afs/cern.ch/user/s/stesting/stt/prod/SUN-CC/debug_NONISO
-> /home3/stesting/prod/SUN-CC/debug_NONISO</tt></b></blockquote>
so you need to be logged into the appropriate machine to see files under
these links.
<h1>
Production and Development Areas</h1>
Under <b><tt>/afs/cern.ch/sw/geant4/stt/</tt></b> there are 3 areas, <b><tt>prod/</tt></b>,
<b><tt>dev1/</tt></b>
and <b><tt>dev2/</tt></b>.&nbsp; In each area there is <b><tt>src/</tt></b>,
<b><tt>testtools/</tt></b>
and one subdirectory per system, e.g., <b><tt>DEC-cxx/</tt></b>,
<b><tt>HP-aCC/</tt></b>,
<b><tt>Linux-g++/</tt></b>,
<b><tt>SUN-CC/</tt></b>,
<b><tt>SUN-CC5/</tt></b>.
<blockquote>
<li>
<b><tt>src/</tt></b>: this contains <b><tt>G4EMLOW0.3/</tt></b>,
<b><tt>G4NDL0.2/</tt></b>
and <b><tt>geant4/</tt></b>.&nbsp; The first two are data directories as
obtained from the <b>Source</b> web page, the last is checked out/updated
from the <b><tt>geant4</tt></b> CVS repository as defined by the <b><tt>*.sdb</tt></b>
files (see Defining the Geant4 Source Tree).</li>

<li>
<b><tt>testtools/:</tt></b> this contains a separately checked out version
of <b><tt>geant4/tests/GNUmakefile</tt></b>, <b><tt>History</tt></b>, <b><tt>README</tt></b>,
<b><tt>mailing_list</tt></b>,
<b><tt>responsibles</tt></b>,
<b><tt>results/
</tt></b>and <b><tt>tools/</tt></b>.&nbsp; This is so that
the scripts (see below) in <b><tt>testtools/geant4/tools/bin/</tt></b>
are decoupled from the versions under <b><tt>src/geant4/tests/tools/bin</tt></b>.&nbsp;
The former are the ones which are effective at run time.&nbsp; This means
one can change and develop them without affecting <b><tt>src/</tt></b>.&nbsp;
To avoid ambiguities with tag names, each of above files or directories
under <b><tt>testtools/geant4/tests/</tt></b>, if changed, must be committed
and tagged with distinctive tag names and proposed for testing in the normal
way so that they get included in reference tags.</li>

<li>
The rest contain binaries and output for each system, debug option and
ISO option, e.g., <b><tt>SUN-CC/debug_NONISO/</tt></b>,&nbsp; which themselves
contain the directories for binaries - <b><tt>bin/</tt></b>,
<b><tt>lib/</tt></b>
and <b><tt>tmp/</tt></b> - for the current tests and
<b><tt>stt/</tt></b>,
a symbolic link to the current test output, e.g., <b><tt>stt -> stt.geant4-01-01-cand-00</tt></b>.&nbsp;
The latter are kept, the directories for binaries are re-used.</li>
</blockquote>

<h1>
Scripts for System Testing</h1>
These are kept in <b><tt>geant4/tests/tools/bin/</tt></b>.&nbsp; Be aware
that there are 6 checked out versions, namely in <b><tt>prod/src/</tt></b>,
<b><tt>dev1/src/</tt></b>,
<b><tt>dev2/src/</tt></b>,
<b><tt>/prod/testtools/</tt></b>,
<b><tt>dev1/testtools/</tt></b>
and <b><tt>dev2/testtools/</tt></b> so please maintain them with CVS, checking
in when you change something, updating in the other areas if necessary.&nbsp;
The current used scripts are in summary:
<br>&nbsp;
<center><table BORDER NOSAVE >
<tr>
<td>g4status.sh</td>

<td>Prints the status of currently running rsh-submitted jobs.</td>
</tr>

<tr>
<td>g4allsys.sh</td>

<td>Reads stt-hosts...data files, submits g4sbr.sh via rsh one per line.</td>
</tr>

<tr>
<td>g4sbr.sh</td>

<td>Submit, build and run.&nbsp; Uses limit.sh and tmpenv.sh</td>
</tr>

<tr>
<td>build.sh</td>

<td>Builds libraries and/or test and examples excutables.</td>
</tr>

<tr>
<td>run.sh</td>

<td>Runs tests and examples.</td>
</tr>

<tr>
<td>limit.sh</td>

<td>Sets limits for some platforms.</td>
</tr>

<tr>
<td>tmpenv.sh</td>

<td>Sets TMPDIR for some platforms.</td>
</tr>

<tr>
<td>setup.sh/csh</td>

<td>"Source" script to set environment based on current platform and working
directory.&nbsp; Sources...</td>
</tr>

<tr>
<td>specific.sh/csh</td>

<td>Detailed platform specific environment setting.</td>
</tr>

<tr>
<td>update.sh</td>

<td>Reads stt...sdb files, updates directory one per line.&nbsp; Uses...</td>
</tr>

<tr>
<td>updt.sh</td>

<td>Basic CVS update instructions.</td>
</tr>
</table></center>

<p>Some other "useful" scripts are also there:
<br>&nbsp;
<center><table BORDER NOSAVE >
<tr>
<td>streamedit.sh</td>

<td>Changes all occurences of given string in given file(s).</td>
</tr>

<tr>
<td>rename.sh</td>

<td>Changes names of files, replacing occurences of string in name.</td>
</tr>
</table></center>

<h1>
HTML files for Recording Activities</h1>
The Tags Database and these Procedures are currently an HTML files in <b><tt>geant4/tests/results/</tt></b>.&nbsp;
Maintain them through CVS.&nbsp; When you commit this directory they are
posted on the web automatically.
<h1>
Notifying Tags for Testing</h1>
When he/she wishes to have code tested, a category coordinators should
notify the System Test Team (STT) using <b><tt>geant4-stt@listbox.cern.ch</tt></b>
giving the tag name, its domain (sub-directory) of application and a short
description of the salient features.&nbsp; Co-working tags should also
be specified.
<h1>
Recording a Notified Tag</h1>
When a tag is notified to the STT, the on-standby STT member should update
the Bonsai database, marking the tag "Proposed".
<h1>
Preparing a Tag for Testing</h1>
Update the Bonsai database, marking the tag "Selected.".
<h1>
Submitting a Tags Set to Tests</h1>
In the appropriate System Test Area:
<blockquote>
<li>
Change to <b><tt>testtools/geant4/tests/tools/bin</tt></b>, set <b><tt>G4DEBUG</tt></b>
and/or <b><tt>G4STTNONISO</tt></b> if required, and <b><tt>source setup.csh</tt></b>.</li>

<li>
Prepare an update driver file, say <b><tt>bonsaiXXX.sdb</tt></b>, from
the Bonsai database.</li>

<li>
Update the code, e.g., <b><tt>update.sh [-n] &lt;bonsaiXXX.sdb >&amp;bonsaiXXX.log
&amp;</tt></b>.(csh) or <b><tt>update.sh [-n] &lt;bonsaiXXX.sdb >bonsaiXXX.log
2>&amp;1 &amp;</tt></b> (sh).</li>

<li>
Check the log file for unexpected CVS flags <b><tt>C</tt></b>, <b><tt>M</tt></b>,
or <b><tt>?</tt></b>.</li>

<li>
Prepare a file, say <b><tt>hostsXXX.data</tt></b>, for piping into <b><tt>g4allsys.sh</tt></b>
and run it, e.g., <b><tt>g4allsys.sh &lt;hostsXXX.data</tt></b>.</li>

<li>
Check with <b><tt>g4status.sh</tt></b>.&nbsp; Check log files, e.g., <b><tt>sungeant.&lt;area>.deb_NONISO.log</tt></b>
for errors.</li>
</blockquote>

<h1>
Inspecting the Output</h1>
The output is in <b><tt>/afs/cern.ch/sw/geant4/stt/&lt;area>/$G4SYSTEM/&lt;debug-ISO-option>/stt/$G4SYSTEM</tt></b>
as appropriate (the last <b><tt>stt</tt></b> is a symbolic link to the
current results sub-directory name).&nbsp; <b><tt>.diff</tt></b> files
compare the <b><tt>.out</tt></b> files with the "reference"
<b><tt>.out</tt></b>
files in the source tree, e.g.,
<b><tt>test01.diff</tt></b> is <b><tt>diff
-w test01.out $G4INSTALL/tests/test01/test01.out</tt></b>.
<p>If all's well, update the Bonsai database and mark the tag(s) "Accepted"
or "Rejected".&nbsp; <i>Notify the category coordinator.</i>
<p>After a few tags have built up, or for the monthly reference tag, consider
placing a global (geant4-wide) reference tag on the geant4 source tree
- see below.
<h1>
Large N Tests</h1>
Periodically, say every other weekend, submit "large N" tests.&nbsp; This
is done by setting the "action" parameter on each line of the job submission
driver file <b><tt>bonsaiXXX.large_N.data</tt></b>. to
<b><tt>large_N</tt></b>.&nbsp;
Note that the binaries must already be in place from an earlier normal
build.
<p>This option runs jobs in the following cases: (a) if a test or example
has a file ending in <b><tt>large_N.in</tt></b>, in which case this file
is taken instead of the normal <b><tt>.in</tt></b> file, or (b) if a job's
input is generated by an "hadronic exerciser", in which case the exerciser
is run with the large N option.
<h1>
Making a Global (geant4-wide) Reference Tag</h1>
Make sure <b><tt>src/geant/tests</tt></b> is up to date.&nbsp; In <b><tt>src/geant4/</tt></b>
of the relevant test area, <b><tt>cvs tag &lt;tag-name> >&amp; cvs_log_&lt;tag-name>.log
&amp;</tt></b>, where <b><tt>&lt;tag-name></tt></b> is <b><tt>geant4-xx-yy-ref-zz</tt></b>,
where <b><tt>xx-yy</tt></b> refer to the most recent past Geant4 release
and <b><tt>zz</tt></b> is a serial number.
<p>Announce on the Tags Blackboard and invite category coordinators to
add further information.
<h1>
Candidate Tags</h1>
These are simply global tags used internally by the STT to define a version
of geant4 which has not yet been tested.&nbsp; The format is <b><tt>geant4-xx-yy-cand-zz</tt></b>,
where <b><tt>zz</tt></b> refers to the next global reference tag.
<br>
<hr WIDTH="100%">
<br><i><a href="mailto:John.Allison@man.ac.uk">John Allison</a> ,
<a href="mailto:Serguei.Sadilov@cern.ch">Serguei
Sadilov</a>&nbsp; and <a href="mailto:Steve.O'Neale@cern.ch">Steve O'Neale</a>&nbsp;
28th June 2000</i>
</body>
</html>
